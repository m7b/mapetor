#https://github.com/ainfosec/ci_helloworld

#
# Configuration
#
language: cpp
dist: xenial
services:
  - xvfb

#
# Build Dependencies
#
before_script:
- mkdir build
- cd build

#
# Build Matrix
#
matrix:
  include:

  #
  # Build Release
  #
  - os: linux
    env:
      - TEST="Build Release"

    addons:
      apt:
        sources:
          - ubuntu-toolchain-r-test
        packages:
          #- libboost-all-dev
          #- libwxgtk3.0-dev:i386
          #- libwxgtk3.0-dev
          - libgtk-3-dev
          - doxygen
          - graphviz
          - pandoc
          #- libc6-dev-i386
          - libc6-dev
          - gcc-multilib
          - g++-multilib

    compiler: gcc

    before_install:
      #
      # Install latest wxFormBuilder
      - sudo add-apt-repository ppa:alexlarsson/flatpak -y
      - sudo apt update
      - sudo apt install flatpak
      - sudo flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
      - sudo flatpak install --assumeyes flathub org.freedesktop.Platform//18.08
      - wget https://github.com/wxFormBuilder/wxFormBuilder/releases/download/v3.9.0/wxformbuilder.flatpak
      - sudo flatpak install --assumeyes wxformbuilder.flatpak
      - sudo flatpak run org.wxformbuilder.wxFormBuilder -g wxfb/wxfb_main_frame.fbp
      - sudo flatpak run org.wxformbuilder.wxFormBuilder -g wxfb/wxfb_info_dialog.fbp
      #
      # Install latest boost
      - wget -O boost.tar.bz2 https://sourceforge.net/projects/boost/files/boost/1.70.0/boost_1_70_0.tar.bz2/download
      - tar xjf boost.tar.bz2
      - ls
      - cd boost_1_70_0
      - sudo ./bootstrap.sh --prefix=/usr/local
      - sudo ./b2 headers
      - sudo ./b2 install --with-filesystem --with-date_time --with-test
      - cd ..
      #
      # Install wxWidgets
      - wget -O wxWidgets-3.0.4.tar.bz2 https://github.com/wxWidgets/wxWidgets/releases/download/v3.0.4/wxWidgets-3.0.4.tar.bz2
      - tar xjf wxWidgets-3.0.4.tar.bz2
      - cd wxWidgets-3.0.4
      - mkdir build-gtk
      - cd build-gtk
      - ../configure --enable-unicode --disable-shared
      - make -j4
      - make install
      - cd ..
      
    
    script:
      #- wx-config --list
      #- ls -l /usr/lib/x86_64-linux-gnu
      - cmake -DCMAKE_BUILD_TYPE=Release ..
      - make
